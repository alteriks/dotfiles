#!/bin/sh
# Syncthing create dir for syncthing.sock (used by nginx)
mkdir -p /var/run/syncthing
chown alteriks /var/run/syncthing
chmod 700 /var/run/syncthing

systemctl disable --now systemd-timesyncd
systemctl enable --now chronyd
systemctl enable --now docker
systemctl enable --now libvirtd
systemctl enable --now sshd

# Enable for ykman/ykman-gui (yubikey-manager-qt)
systemctl enable --now pcscd

systemctl enable --now smartd
systemctl enable --now syncthing@alteriks
systemctl enable --now tmux@alteriks
systemctl enable --now tailscaled
systemctl enable --now zerotier-one


{% if yadm.hostname == "nebula" %}
systemctl enable --now zfs-trim@pool.timer
systemctl enable --now zfs-scrub@pool.timer
systemctl enable --now sanoid.timer
{% endif %}
{% if yadm.hostname == "moar" %}
systemctl enable --now zfs-trim@pool.timer
systemctl enable --now zfs-scrub@pool.timer
systemctl enable --now sanoid.timer
{% endif %}

chmod 600 /etc/openfortivpn/config

#systemctl enable numLockOnTty

#neeeded for libvirt restore
virsh net-autostart vagrant-libvirt
virsh net-start vagrant-libvirt

#ansible
#useradd -r -m  -G wheel ansible
#sudo -u ansible -c "ssh-keygen -t ed25519"

usermod -aG docker alteriks

# Needed for accesing RPi Pico /dev/ttyACM* and thonny
usermod -a -G uucp alteriks

# Other groups
usermod -a -G wheel,audio,input,storage,video,sys,network,power,libvirt alteriks

mkdir -p /mnt/{1,2,luks,sdm,veracrypt,zpool}
